<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/css/common-styles.css">
    <title>Управление парковочными местами</title>

    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1em;
        }
        
        th, td {
            padding: 0.5em;
            text-align: left;
            
        }
        
 
        
        tr.occupied {
            background-color: #ffebee;
        }
        
        .controls {
            margin: 1em 0;
        }
    </style>
</head>

<body>
    <h1>Управление парковочными местами</h1>

    <div class="controls">
        <input type="number" id="new-space-number" placeholder="Номер места">
        <button onclick="createParkingSpace()">Добавить место</button>
    </div>

    <div id="parking-spaces-list">
        <!-- Parking spaces will be listed here -->
    </div>

    <script>
        function loadParkingSpaces() {
            fetch('/admin/parking-spaces')
                .then(response => response.json())
                .then(spaces => {
                    const container = document.getElementById('parking-spaces-list');
                    container.innerHTML = '';
                    
                    spaces.sort((a, b) => a.number - b.number);
                    
                    const table = document.createElement('table');
                    table.innerHTML = `
                        <thead>
                            <tr>
                                <th>Номер места</th>
                                <th>Статус</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    `;
                    
                    spaces.forEach(space => {
                        const row = document.createElement('tr');
                        row.className = space.occupied ? 'occupied' : '';
                        
                        row.innerHTML = `
                            <td>${space.number}</td>
                            <td>${space.occupied ? `Занято: ${space.registrationNumber}` : 'Свободно'}</td>
                            <td>
                                ${!space.occupied ? 
                                    `<button onclick="removeParkingSpace(${space.number})">Удалить</button>` :
                                    ''
                                }
                            </td>
                        `;
                        
                        table.querySelector('tbody').appendChild(row);
                    });
                    
                    container.appendChild(table);
                })
                .catch(error => {
                    console.error('Error loading parking spaces:', error);
                    alert('Ошибка при загрузке парковочных мест');
                });
        }

        function createParkingSpace() {
            const numberInput = document.getElementById('new-space-number');
            const number = numberInput.value;

            if (!number) {
                alert('Введите номер места');
                return;
            }

            fetch('/admin/create-parking-space', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ number: parseInt(number) })
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text) });
                }
                numberInput.value = '';
                loadParkingSpaces();
            })
            .catch(error => {
                console.error('Error creating parking space:', error);
                alert(error.message);
            });
        }

        function removeParkingSpace(number) {
            if (!confirm(`Удалить парковочное место №${number}?`)) {
                return;
            }

            fetch('/admin/remove-parking-space', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ number })
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text) });
                }
                loadParkingSpaces();
            })
            .catch(error => {
                console.error('Error removing parking space:', error);
                alert(error.message);
            });
        }

        // Load parking spaces when page loads
        loadParkingSpaces();
    </script>
</body>
</html>
